#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#       __________  __ ___       _____    ________            
#      / ____/ __ \/ // / |     / /   |  /  _/ __ \____  _____
#     / /   / /_/ / // /| | /| / / /| |  / // / / / __ \/ ___/
#    / /___/ ____/__  __/ |/ |/ / ___ |_/ // /_/ / /_/ (__  ) 
#    \____/_/      /_/  |__/|__/_/  |_/___/\____/ .___/____/  
#                                              /_/            
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#---------------------------------------------------------------------------------------------------------------------------------------------------"
#  Installing CP4WAIOPS
#
#  CloudPak for Watson AIOps
#
#  Â©2022 nikh@ch.ibm.com
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# Installs:
#
#  - Turbonomic
#  - Turbonomic Demo Content
#     - Demo User
#     - RobotShop Demo App with synthetic metric
#     - Instana target (if Instana is installed - you have to enter the API Token Manually)
#     - Groups for vCenter and RobotShop
#     - Groups for licensing
#     - Resource Hogs

# ---------------------------------------------------------------------------------------------------------------------------------------------------"
# ---------------------------------------------------------------------------------------------------------------------------------------------------"
 

- hosts: localhost
  #become: true
  #vars_files: {{ config_file }}

  tasks:
  - name: ðŸš€ MAIN INSTALLATION LOOP - Install Module
    debug: 
      msg: 
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"
      - "                                                                                                                                                   "
      - "       CloudPak for Watson AIOps - INSTALLATION - Turbonomic                                                                             "
      - "                                                                                                                                                   "
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"
      - "***************************************************************************************************************************************************"



  - name: ðŸš€ TEST
    shell: |
      echo "_tI3RmLx4m9EH-abvdc53DYEkbYY" > /tmp/pwd.yaml
      rm /tmp/license.yaml
    register: CLUSTER_NAME
    ignore_errors: true




  - name: ðŸŸ£  Show Global Config
    debug:
      var: test


  - name: ðŸš€ TEST
    shell: |
      ansible-vault decrypt --vault-password-file /tmp/pwd.yaml --output /tmp/license.yaml ../DO_NOT_DELIVER/20_LICENSES.yaml 
    ignore_errors: true

  - name: ðŸš€ TEST
    shell: |
      rm /tmp/pwd.yaml
      cat /tmp/license.yaml
    ignore_errors: true

  - name: Include vars for Licenses
    ansible.builtin.include_vars:
      file: /tmp/license.yaml
      name: licenses
    ignore_errors: true

  - name: ðŸš€ TEST
    shell: |
      rm /tmp/license.yaml
    ignore_errors: true

  - name: ðŸŸ£  Show Global Config
    debug:
      var: CLUSTER_NAME.stdout_lines
        #verbosity: 2


  - name: ðŸŸ£  Show Global Config
    debug:
      var: licenses
        #verbosity: 2
